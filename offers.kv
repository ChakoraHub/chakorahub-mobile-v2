#:import dp kivy.metrics.dp
#:import hex kivy.utils.get_color_from_hex

<DropdownHoverButton>:
    background_normal: ''
    background_color: self.background_color
    size_hint_y: None
    height: dp(48)
    color: 0.29,0.08,0.55,1
    halign: "center"
    valign: "middle"
    text_size: self.size
    font_name: "EmojiFont"

<HoverButton>:
    background_normal: ''
    background_color: self.background_color
    size_hint_y: None
    height: dp(50)
    color: 0.29,0.08,0.55,1
    halign: "center"
    valign: "middle"
    text_size: self.size
    font_name: "EmojiFont"

<OfferRow>:
    spacing: dp(2)
    size_hint_y: None
    height: dp(45)
    padding: dp(5)

    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: 0.85, 0.85, 0.9, 1
        Line:
            width: 0.5
            rectangle: self.x, self.y, self.width, self.height

    Label:
        text: root.course
        text_size: self.width, None
        halign: 'left'
        valign: 'middle'
        padding: [dp(10), 0]
        shorten: True
        shorten_from: 'right'
        color: 0.2, 0.2, 0.2, 1
        font_size: '13sp'
        bold: False
    Label:
        text: root.fee
        text_size: self.width, None
        halign: 'center'
        valign: 'middle'
        color: 0.2, 0.2, 0.2, 1
        font_size: '13sp'
        bold: False
    Label:
        text: root.discount
        text_size: self.width, None
        halign: 'center'
        valign: 'middle'
        color: 0.9, 0.3, 0.2, 1
        font_size: '13sp'
        bold: True
    Label:
        text: root.discounted_fee
        text_size: self.width, None
        halign: 'center'
        valign: 'middle'
        color: 0, 0.6, 0.2, 1
        font_size: '13sp'
        bold: True
    Label:
        text: root.valid_from
        text_size: self.width, None
        halign: 'center'
        valign: 'middle'
        color: 0.2, 0.2, 0.2, 1
        font_size: '13sp'
        bold: False
    Label:
        text: root.valid_to
        text_size: self.width, None
        halign: 'center'
        valign: 'middle'
        color: 0.2, 0.2, 0.2, 1
        font_size: '13sp'
        bold: False
    Label:
        text: root.status
        text_size: self.width, None
        halign: 'center'
        valign: 'middle'
        font_size: '12sp'
        bold: True
        color: 
            (0, 0.7, 0, 1) if root.status == "Active" else \
            (0.7, 0.7, 0.7, 1) if root.status == "Inactive" else \
            (0.8, 0.5, 0, 1) if root.status == "Upcoming" else \
            (0.8, 0, 0, 1) if root.status == "Expired" else \
            (0.2, 0.2, 0.2, 1)
    Button:
        text: "üóë Delete"
        size_hint_x: None
        width: dp(80)
        background_color: 0.9, 0.2, 0.2, 1
        color: 1, 1, 1, 1
        font_size: '12sp'
        bold: True
        on_release: app.root.delete_offer(root.offer_id)
        canvas.before:
            Color:
                rgba: self.background_color
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [5]

<OffersScreen>:
    name: "offers_screen"
    course_spinner: course_spinner
    
    BoxLayout:
        orientation: "vertical"
        spacing: dp(0)
        padding: dp(0)

        canvas.before:
            Rectangle:
                source: "images/background.jpg"
                pos: self.pos
                size: self.size

        # ---------- HEADER ----------
        BoxLayout:
            size_hint_y: None
            height: dp(100)
            padding: dp(30), dp(10)
            spacing: dp(10)
            canvas.before:
                Color:
                    rgba: 0.56,0.42,0.80,1
                Rectangle:
                    pos: self.pos
                    size: self.size

            Image:
                source: "images/logo.png"
                size_hint_x: None
                width: dp(80)

            Label:
                text: "üéÅ Manage Course Offers"
                font_size: "26sp"
                bold: True
                color: 1,1,1,1
                font_name: "EmojiFont"

            AnchorLayout:
                anchor_x: 'right'
                size_hint_x: None
                width: dp(70)
                Button:
                    id: profile_button
                    size_hint: None, None
                    size: dp(50), dp(50)
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    on_release: root.open_profile_dropdown(self)
                    
                    canvas.before:
                        Color:
                            rgba: 1,1,1,1
                        Ellipse:
                            pos: self.pos
                            size: self.size
                    Image:
                        source: root.profile_pic
                        size: self.parent.size
                        pos: self.parent.pos

        # ---------- SCROLLABLE CONTENT ----------
        ScrollView:
            do_scroll_x: False
            bar_width: dp(10)
            
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(50)
                padding: dp(30)

                # Top spacer - PROPER GAP AFTER HEADER
                Widget:
                    size_hint_y: None
                    height: dp(40)

                # ---------- ADD OFFER FORM ----------
                AnchorLayout:
                    anchor_x: "center"
                    size_hint_y: None
                    height: dp(600)
                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint: None, None
                        size: dp(500), dp(600)
                        padding: dp(30)
                        spacing: dp(20)
                        canvas.before:
                            Color:
                                rgba: 1, 1, 1, 0.95
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [15]
                            Color:
                                rgba: 0, 0, 0, 0.15
                            RoundedRectangle:
                                pos: [self.x+4, self.y-4]
                                size: self.size
                                radius: [15]

                        # Title - FIXED TEXT
                        Label:
                            text: "Add New Offer"
                            font_size: "22sp"
                            color: 0.27, 0.16, 0.63, 1
                            halign: "center"
                            size_hint_y: None
                            height: dp(50)
                            bold: True
                            text_size: self.width, None

                        # Course Selection - FIXED TEXT
                        BoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: dp(85)
                            spacing: dp(8)

                            Label:
                                text: "Select Course:"
                                font_size: "16sp"
                                size_hint_y: None
                                height: dp(30)
                                halign: "left"
                                valign: "middle"
                                text_size: self.width, None
                                color: 0.2, 0.2, 0.2, 1
                                bold: True

                            Spinner:
                                id: course_spinner
                                text: "-- Select Course --"
                                values: ["-- Select Course --"]
                                size_hint_y: None
                                height: dp(45)
                                background_color: 1, 1, 1, 1
                                color: 0.2, 0.2, 0.2, 1
                                background_normal: ""
                                background_down: ""
                                option_cls: "SpinnerOption"
                                canvas.before:
                                    Color:
                                        rgba: 0.8, 0.8, 0.9, 1
                                    Line:
                                        width: 1
                                        rounded_rectangle: [self.x, self.y, self.width, self.height, 5]

                        # Discount Input - FIXED TEXT
                        BoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: dp(85)
                            spacing: dp(8)

                            Label:
                                text: "Discount (%):"
                                font_size: "16sp"
                                size_hint_y: None
                                height: dp(30)
                                halign: "left"
                                valign: "middle"
                                text_size: self.width, None
                                color: 0.2, 0.2, 0.2, 1
                                bold: True

                            TextInput:
                                id: discount_input
                                hint_text: "Enter discount percentage (1-100)"
                                input_filter: "int"
                                size_hint_y: None
                                height: dp(45)
                                multiline: False
                                padding: [dp(10), dp(10), 0, 0]
                                foreground_color: 0.2, 0.2, 0.2, 1
                                background_color: 1, 1, 1, 1
                                canvas.before:
                                    Color:
                                        rgba: 0.8, 0.8, 0.9, 1
                                    Line:
                                        width: 1
                                        rounded_rectangle: [self.x, self.y, self.width, self.height, 5]

                        # Valid From - FIXED TEXT
                        BoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: dp(85)
                            spacing: dp(8)

                            Label:
                                text: "Valid From:"
                                font_size: "16sp"
                                size_hint_y: None
                                height: dp(30)
                                halign: "left"
                                valign: "middle"
                                text_size: self.width, None
                                color: 0.2, 0.2, 0.2, 1
                                bold: True

                            TextInput:
                                id: valid_from_input
                                hint_text: "YYYY-MM-DD (optional)"
                                size_hint_y: None
                                height: dp(45)
                                multiline: False
                                padding: [dp(10), dp(10), 0, 0]
                                foreground_color: 0.2, 0.2, 0.2, 1
                                background_color: 1, 1, 1, 1
                                canvas.before:
                                    Color:
                                        rgba: 0.8, 0.8, 0.9, 1
                                    Line:
                                        width: 1
                                        rounded_rectangle: [self.x, self.y, self.width, self.height, 5]

                        # Valid To - FIXED TEXT
                        BoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: dp(85)
                            spacing: dp(8)

                            Label:
                                text: "Valid To:"
                                font_size: "16sp"
                                size_hint_y: None
                                height: dp(30)
                                halign: "left"
                                valign: "middle"
                                text_size: self.width, None
                                color: 0.2, 0.2, 0.2, 1
                                bold: True

                            TextInput:
                                id: valid_to_input
                                hint_text: "YYYY-MM-DD (optional)"
                                size_hint_y: None
                                height: dp(45)
                                multiline: False
                                padding: [dp(10), dp(10), 0, 0]
                                foreground_color: 0.2, 0.2, 0.2, 1
                                background_color: 1, 1, 1, 1
                                canvas.before:
                                    Color:
                                        rgba: 0.8, 0.8, 0.9, 1
                                    Line:
                                        width: 1
                                        rounded_rectangle: [self.x, self.y, self.width, self.height, 5]

                        # Save Button
                        Button:
                            text: "üíæ Save Offer"
                            size_hint_y: None
                            height: dp(55)
                            background_color: 0.37, 0.21, 0.69, 1
                            color: 1, 1, 1, 1
                            font_size: "18sp"
                            bold: True
                            on_release: root.add_offer()
                            font_name: "EmojiFont"
                            canvas.before:
                                Color:
                                    rgba: self.background_color
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [10]

                # ---------- OFFERS LIST ----------
                AnchorLayout:
                    anchor_x: "center"
                    size_hint_y: None
                    height: dp(500)
                    
                    BoxLayout:
                        orientation: "vertical"
                        size_hint: None, None
                        size: dp(900), dp(500)
                        padding: dp(20)
                        spacing: dp(15)
                        canvas.before:
                            Color:
                                rgba: 1, 1, 1, 0.95
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [15]
                            Color:
                                rgba: 0, 0, 0, 0.15
                            RoundedRectangle:
                                pos: [self.x+4, self.y-4]
                                size: self.size
                                radius: [15]

                        # Title - FIXED TEXT
                        Label:
                            text: "Current Offers"
                            font_size: "22sp"
                            color: 0.27, 0.16, 0.63, 1
                            halign: "center"
                            size_hint_y: None
                            height: dp(50)
                            bold: True
                            text_size: self.width, None

                        # Table headers
                        GridLayout:
                            cols: 8
                            size_hint_y: None
                            height: dp(50)
                            spacing: dp(2)

                            canvas.before:
                                Color:
                                    rgba: 0.56, 0.42, 0.80, 1
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [8, 8, 0, 0]

                            Label:
                                text: "Course"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'left'
                                padding: [dp(15), 0]
                                font_size: '14sp'
                            Label:
                                text: "Fee"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'center'
                                font_size: '14sp'
                            Label:
                                text: "Discount"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'center'
                                font_size: '14sp'
                            Label:
                                text: "Discounted"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'center'
                                font_size: '14sp'
                            Label:
                                text: "From"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'center'
                                font_size: '14sp'
                            Label:
                                text: "To"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'center'
                                font_size: '14sp'
                            Label:
                                text: "Status"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'center'
                                font_size: '14sp'
                            Label:
                                text: "Action"
                                bold: True
                                color: 1, 1, 1, 1
                                text_size: self.width, None
                                halign: 'center'
                                font_size: '14sp'

                        # Offers list
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_y: None
                            height: dp(380)
                            
                            RecycleView:
                                id: offers_rv
                                viewclass: "OfferRow"
                                size_hint_y: None
                                height: dp(380)
                                bar_width: dp(8)
                                canvas.before:
                                    Color:
                                        rgba: 0.95, 0.95, 0.98, 1
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [0, 0, 8, 8]

                                RecycleBoxLayout:
                                    orientation: 'vertical'
                                    default_size: None, dp(45)
                                    default_size_hint: 1, None
                                    size_hint_y: None
                                    height: self.minimum_height
                                    spacing: dp(2)

                # ---------- BACK BUTTON ----------
                AnchorLayout:
                    anchor_x: "center"
                    size_hint_y: None
                    height: dp(70)
                    
                    Button:
                        text: "‚¨ÖÔ∏è Back to Resources"
                        font_size: '18sp'
                        bold: True
                        size_hint: None, None
                        size: dp(250), dp(50)
                        background_normal: ''
                        background_color: 0.0, 0.48, 1, 1
                        color: 1, 1, 1, 1
                        on_release: root.back_to_resources()
                        font_name: "EmojiFont"
                        canvas.before:
                            Color:
                                rgba: self.background_color
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [12]

                # Bottom spacer
                Widget:
                    size_hint_y: None
                    height: dp(50)

        # ---------- FOOTER ----------
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            canvas.before:
                Color:
                    rgba: 0.56,0.42,0.80,1
                Rectangle:
                    pos: self.pos
                    size: self.size
            Label:
                text: "ChakoraHub ¬© 2025. All rights reserved."
                color: 1,1,1,1
                halign: "center"
                valign: "middle"
                text_size: self.size